{% extends "base.html" %} {% block content %}
<h1 class="mt-4">F1 Drivers</h1>

<h2 class="mt-4">Add Team</h2>
<form id="team-form" class="mb-4">
	<div class="form-group">
		<label for="team-name">Team Name</label>
		<input type="text" class="form-control" id="team-name" name="team-name" required />
	</div>
	<button type="submit" class="btn btn-primary">Add Team</button>
</form>

<h2 class="mt-4">Add Driver</h2>
<form id="driver-form" class="mb-4">
	<div class="form-group">
		<label for="name">Name</label>
		<input type="text" class="form-control" id="name" name="name" required />
	</div>
	<div class="form-group">
		<label for="team">Team</label>
		<select class="form-control" id="team" name="team" required></select>
	</div>
	<div class="form-group">
		<label for="championships">Championships</label>
		<input type="number" class="form-control" id="championships" name="championships" required />
	</div>
	<button type="submit" class="btn btn-primary">Add Driver</button>
	<button type="button" class="btn btn-secondary" id="update-driver" style="display: none">Update Driver</button>
</form>

<ul id="drivers-list" class="list-group"></ul>

<script>
	$(document).ready(function () {
		fetchTeams();
		fetchDrivers();

		$("#team-form").submit(function (event) {
			event.preventDefault();
			var team = {
				name: $("#team-name").val(),
			};

			$.ajax({
				url: "/teams",
				method: "POST",
				contentType: "application/json",
				data: JSON.stringify(team),
				success: function (response) {
					fetchTeams();
					$("#team-form")[0].reset();
				},
				error: function (xhr, status, error) {
					console.error("Error:", error);
				},
			});
		});

		$("#driver-form").submit(function (event) {
			event.preventDefault();
			var driver = {
				name: $("#name").val(),
				team: $("#team").val(),
				championships: $("#championships").val(),
			};

			$.ajax({
				url: "/drivers",
				method: "POST",
				contentType: "application/json",
				data: JSON.stringify(driver),
				success: function (response) {
					fetchDrivers();
					$("#driver-form")[0].reset();
				},
				error: function (xhr, status, error) {
					console.error("Error:", error);
				},
			});
		});

		$("#update-driver").click(function () {
			var driverId = $(this).data("id");
			var driver = {
				name: $("#name").val(),
				team: $("#team").val(),
				championships: $("#championships").val(),
			};

			$.ajax({
				url: "/drivers/" + driverId,
				method: "PUT",
				contentType: "application/json",
				data: JSON.stringify(driver),
				success: function (response) {
					fetchDrivers();
					$("#driver-form")[0].reset();
					$("#update-driver").hide();
					$("#driver-form button[type=submit]").show();
				},
				error: function (xhr, status, error) {
					console.error("Error:", error);
				},
			});
		});
	});

	function fetchTeams() {
		$.get("/teams", function (teams) {
			$("#team").empty();
			teams.forEach(function (team) {
				var option = `<option value="${team.name}">${team.name}</option>`;
				$("#team").append(option);
			});
		});
	}

	function fetchDrivers() {
		$.get("/drivers", function (drivers) {
			$("#drivers-list").empty();
			drivers.forEach(function (driver) {
				var driverItem = `<li class="list-group-item">
                ${driver.name} - ${driver.team} (${driver.championships})
                <button class="btn btn-sm btn-warning float-right ml-2" onclick="editDriver(${driver.id})">Edit</button>
                <button class="btn btn-sm btn-danger float-right" onclick="deleteDriver(${driver.id})">Delete</button>
            </li>`;
				$("#drivers-list").append(driverItem);
			});
		});
	}

	function editDriver(id) {
		$.get("/drivers/" + id, function (driver) {
			$("#name").val(driver.name);
			$("#team").val(driver.team);
			$("#championships").val(driver.championships);
			$("#update-driver").data("id", id).show();
			$("#driver-form button[type=submit]").hide();
		});
	}

	function deleteDriver(id) {
		$.ajax({
			url: "/drivers/" + id,
			method: "DELETE",
			success: function (response) {
				fetchDrivers();
			},
			error: function (xhr, status, error) {
				console.error("Error:", error);
			},
		});
	}
</script>
{% endblock %}
